<Page
  x:Class="PanoramioExplorer.Views.MapView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="using:PanoramioExplorer.Controls"
  xmlns:core="using:Microsoft.Xaml.Interactions.Core"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
  xmlns:maps="using:Windows.UI.Xaml.Controls.Maps"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:viewModels="using:PanoramioExplorer.ViewModels"
  d:DataContext="{d:DesignInstance viewModels:MapViewModel}"
  mc:Ignorable="d">

  <Page.Resources>
    <SolidColorBrush x:Key="SemiBlack" Color="#CC151313" />
    
    <DataTemplate x:Key="PhotoTemplate">
      <controls:PhotoImage
        Title="{Binding Title}"
        Width="150"
        Height="150"
        Background="White"
        Foreground="Black"
        ImageSource="{Binding Source}" />
    </DataTemplate>

    <Style x:Key="PhotoContainerStyle" TargetType="ListViewItem">
      <Setter Property="Padding" Value="0" />
      <Setter Property="Margin" Value="0,12" />
      <Setter Property="HorizontalAlignment" Value="Center" />
    </Style>
  </Page.Resources>

  <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <!--
    Y U NOT WORKIN'?! *RAGE*

    <interactivity:Interaction.Behaviors>
      <core:DataTriggerBehavior
        Binding="{Binding SelectedPhoto}"
        Value="{x:Null}">
        <core:GoToStateAction StateName="ShowingPhoto" />
      </core:DataTriggerBehavior>
      <core:DataTriggerBehavior
        Binding="{Binding SelectedPhoto}"
        ComparisonCondition="NotEqual"
        Value="{x:Null}">
        <core:GoToStateAction StateName="NoPhotoShown" />
      </core:DataTriggerBehavior>
    </interactivity:Interaction.Behaviors>
    -->

    <maps:MapControl
      x:Name="Map"
      ActualCameraChanged="OnMapCameraMoved"
      BusinessLandmarksVisible="True"
      LandmarksVisible="True"
      PedestrianFeaturesVisible="True"
      RotateInteractionMode="Disabled"
      ZoomLevel="4" />

    <ListView
      x:Name="PhotoPreviewList"
      Width="200"
      HorizontalAlignment="Right"
      Background="{StaticResource SemiBlack}"
      ItemContainerStyle="{StaticResource PhotoContainerStyle}"
      ItemTemplate="{StaticResource PhotoTemplate}"
      ItemsSource="{Binding Photos}"
      SelectedItem="{Binding SelectedPhoto, Mode=TwoWay}"
      SelectionChanged="OnPhotoSelectionChange" />

    <Grid
      x:Name="Gallery"
      Padding="24"
      Background="Transparent"
      Opacity="0"
      IsHitTestVisible="False">
      <Grid.RowDefinitions>
        <RowDefinition />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <Image
        Margin="12"
        Source="{Binding SelectedPhoto.Source}" />
      <TextBlock
        Grid.Row="1"
        Foreground="White"
        FontSize="36"
        MaxLines="3"
        Text="{Binding SelectedPhoto.Title}"
        TextAlignment="Center"
        TextTrimming="CharacterEllipsis"
        TextWrapping="WrapWholeWords" />
    </Grid>

    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup x:Name="GalleryModeStateGroup">
        <VisualState x:Name="ShowingPhoto">
          <VisualState.Setters>
            <Setter Target="Gallery.(UIElement.IsHitTestVisible)" Value="True" />
          </VisualState.Setters>
          <Storyboard>
            <ColorAnimation
              Duration="0:0:0.3"
              Storyboard.TargetName="Gallery"
              Storyboard.TargetProperty="(UIElement.Background).(SolidColorBrush.Color)"
              To="#CC292929">
              <ColorAnimation.EasingFunction>
                <CircleEase EasingMode="EaseOut" />
              </ColorAnimation.EasingFunction>
            </ColorAnimation>
            <DoubleAnimation
              Duration="0:0:0.3"
              Storyboard.TargetName="Gallery"
              Storyboard.TargetProperty="(UIElement.Opacity)"
              To="1">
              <DoubleAnimation.EasingFunction>
                <CubicEase EasingMode="EaseOut" />
              </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
          </Storyboard>
        </VisualState>
        <VisualState x:Name="NoPhotoShown" />
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
  </Grid>
</Page>